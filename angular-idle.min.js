/*** Directives and services for responding to idle users in AngularJS
* @author Mike Grabski <me@mikegrabski.com>
* @version v1.1.1
* @link https://github.com/HackedByChinese/ng-idle.git
* @license MIT
*/

!function(a,b,c){"use strict";b.module("ngIdle",["ngIdle.keepalive","ngIdle.idle","ngIdle.countdown","ngIdle.title","ngIdle.localStorage"]),b.module("ngIdle.keepalive",[]).provider("Keepalive",function(){var a={http:null,interval:600};this.http=function(c){if(!c)throw new Error("Argument must be a string containing a URL, or an object containing the HTTP request configuration.");b.isString(c)&&(c={url:c,method:"GET"}),c.cache=!1,a.http=c};var c=this.interval=function(b){if(b=parseInt(b),isNaN(b)||0>=b)throw new Error("Interval must be expressed in seconds and be greater than 0.");a.interval=b};this.$get=["$rootScope","$log","$interval","$http",function(d,e,f,g){function h(a,b){d.$broadcast("KeepaliveResponse",a,b)}function i(){d.$broadcast("Keepalive"),b.isObject(a.http)&&g(a.http).success(h).error(h)}var j={ping:null};return{_options:function(){return a},setInterval:c,start:function(){return f.cancel(j.ping),j.ping=f(i,1e3*a.interval),j.ping},stop:function(){f.cancel(j.ping)},ping:function(){i()}}}]}),b.module("ngIdle.idle",["ngIdle.keepalive","ngIdle.localStorage"]).provider("Idle",function(){var a={idles:{"default":{idle:1200}},timeoutTrigger:"default",timeout:30,autoResume:"idle",interrupt:"mousemove keydown DOMMouseScroll mousewheel mousedown touchstart touchmove scroll",keepalive:!0},d=this.timeout=function(c){if(c===!1)a.timeout=0;else{if(!(b.isNumber(c)&&c>=0))throw new Error("Timeout must be zero or false to disable the feature, or a positive integer (in seconds) to enable it.");a.timeout=c}};this.interrupt=function(b){a.interrupt=b};var e=function(b,c){var d=a.idles[b?b:"default"];return c&&!d&&(d={},a.idles[b]=d),d},f=this.idle=function(b,c){if(0>=b)throw new Error("Idle must be a value in seconds, greater than 0.");e(c,!0).idle=b;for(var d in a.idles)a.idles.hasOwnProperty(d)&&a.idles[d].idle>a.idles[a.timeoutTrigger].idle&&(a.timeoutTrigger=d)};this.autoResume=function(b){b===!0?a.autoResume="idle":b===!1?a.autoResume="off":a.autoResume=b},this.keepalive=function(b){a.keepalive=b===!0},this.$get=["$interval","$log","$rootScope","$document","Keepalive","IdleLocalStorage","$window",function(g,h,i,j,k,l,m){function n(){a.keepalive&&(y.running&&k.ping(),k.start())}function o(){a.keepalive&&k.stop()}function p(a){if(!a||a===c)return!0;if(Object.getOwnPropertyNames)return!Object.getOwnPropertyNames(a).length>0;for(var b in a)if(a.hasOwnProperty(b))return!1;return!0}function q(b){var c="";b?(y.idling=!!y.idle[b],c+="default"===b?"":b):y.idling=!y.idling,c+=y.idling?"Start":"End",i.$broadcast("Idle"+c),y.idling?(o(),a.timeout&&a.timeoutTrigger===b&&(y.countdown=a.timeout,r(),y.timeout=g(r,1e3,a.timeout,!1))):n();var d=y.idle[b?b:"default"];d&&(g.cancel(d),delete y.idle[b?b:"default"]),b&&!y.idling&&(y.idling=!p(y.idle))}function r(){return y.countdown<=0?void s():(i.$broadcast("IdleWarn",y.countdown),void y.countdown--)}function s(){o(),w(),y.idling=!0,y.running=!1,y.countdown=0,i.$broadcast("IdleTimeout")}function t(a,b,c,d){var e=a.running();a.unwatch(),b(c,d),e&&a.watch()}function u(){var a=l.get("expiry");return a&&a.time?new Date(a.time):null}function v(a){a?l.set("expiry",{id:z,time:a}):l.remove("expiry")}function w(){for(var a in y.idle)y.idle.hasOwnProperty(a)&&g.cancel(y.idle[a]);y.idle={},g.cancel(y.timeout)}function x(){for(var b in a.idles)a.idles.hasOwnProperty(b)&&(y.idle[b]=g(q,1e3*a.idles[b].idle,0,!1,b))}var y={idle:{},timeout:null,idling:!1,running:!1,countdown:null},z=(new Date).getTime(),A={_options:function(){return a},_getNow:function(){return new Date},getIdle:function(a){return e(a)?e(a).idle:c},getTimeout:function(){return a.timeout},setIdle:function(a,b){t(this,f,a,b)},setTimeout:function(a){t(this,d,a)},isExpired:function(){var a=u();return null!==a&&a<=this._getNow()},running:function(){return y.running},idling:function(){return y.idling},watch:function(b){w();var c=a.timeout?a.timeout:0;b||v(new Date((new Date).getTime()+1e3*(e().idle+c))),y.idling?q():y.running||n(),y.running=!0,x()},unwatch:function(){w(),y.idling=!1,y.running=!1,v(null),o()},interrupt:function(b){return y.running?a.timeout&&this.isExpired()?void s():void(("idle"===a.autoResume||"notIdle"===a.autoResume&&!y.idling)&&this.watch(b)):void 0}};j.find("html").on(a.interrupt,function(a){"mousemove"===a.type&&a.originalEvent&&0===a.originalEvent.movementX&&0===a.originalEvent.movementY||("mousemove"!==a.type||b.isUndefined(a.movementX)||a.movementX||a.movementY)&&A.interrupt()});var B=function(a){if("ngIdle.expiry"===a.key&&a.newValue&&a.newValue!==a.oldValue){var c=b.fromJson(a.newValue);if(c.id===z)return;A.interrupt(!0)}};return m.addEventListener?m.addEventListener("storage",B,!1):m.attachEvent("onstorage",B),A}]}),b.module("ngIdle.countdown",["ngIdle.idle"]).directive("idleCountdown",["Idle",function(a){return{restrict:"A",scope:{value:"=idleCountdown"},link:function(b){b.value=a.getTimeout(),b.$on("IdleWarn",function(a,c){b.$evalAsync(function(){b.value=c})}),b.$on("IdleTimeout",function(){b.$evalAsync(function(){b.value=0})})}}}]),b.module("ngIdle.title",[]).provider("Title",function(){function a(a,b,c){return new Array(b-String(a).length+1).join(c||"0")+a}var c={enabled:!0},d=this.enabled=function(a){c.enabled=a===!0};this.$get=["$document","$interpolate",function(e,f){var g={original:null,idle:"{{minutes}}:{{seconds}} until your session times out!",timedout:"Your session has expired."};return{setEnabled:d,isEnabled:function(){return c.enabled},original:function(a){return b.isUndefined(a)?g.original:void(g.original=a)},store:function(a){(a||!g.original)&&(g.original=this.value())},value:function(a){return b.isUndefined(a)?e[0].title:void(e[0].title=a)},idleMessage:function(a){return b.isUndefined(a)?g.idle:void(g.idle=a)},timedOutMessage:function(a){return b.isUndefined(a)?g.timedout:void(g.timedout=a)},setAsIdle:function(b){this.store();var c={totalSeconds:b};c.minutes=Math.floor(b/60),c.seconds=a(b-60*c.minutes,2),this.value(f(this.idleMessage())(c))},setAsTimedOut:function(){this.store(),this.value(this.timedOutMessage())},restore:function(){this.original()&&this.value(this.original())}}}]}).directive("title",["Title",function(a){return{restrict:"E",link:function(b,c,d){a.isEnabled()&&!d.idleDisabled&&(a.store(!0),b.$on("IdleStart",function(){a.original(c[0].innerText)}),b.$on("IdleWarn",function(b,c){a.setAsIdle(c)}),b.$on("IdleEnd",function(){a.restore()}),b.$on("IdleTimeout",function(){a.setAsTimedOut()}))}}}]),b.module("ngIdle.localStorage",[]).provider("IdleStorageAccessor",function(){var a=function(a){var b=a.get("$window");return b.localStorage};this.setStorageGetter=function(b){"function"==typeof b&&(a=b)},this.$get=["$injector",function(b){return{get:function(){return a(b)}}}]}).service("IdleLocalStorage",["IdleStorageAccessor",function(a){function d(){var a={};this.setItem=function(b,c){a[b]=c},this.getItem=function(b){return"undefined"!=typeof a[b]?a[b]:null},this.removeItem=function(b){a[b]=c}}function e(){try{var b=a.get();return b.setItem("ngIdleStorage",""),b.removeItem("ngIdleStorage"),b}catch(c){return new d}}var f=e();return{set:function(a,c){f.setItem("ngIdle."+a,b.toJson(c))},get:function(a){return b.fromJson(f.getItem("ngIdle."+a))},remove:function(a){f.removeItem("ngIdle."+a)},_wrapped:function(){return f}}}])}(window,window.angular);
//# sourceMappingURL=angular-idle.map